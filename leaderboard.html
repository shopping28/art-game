<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Champions Leaderboard</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Header */
        .header { padding: 15px; background: #111; border-bottom: 2px solid #D4AF37; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 10; }
        .back { color: #D4AF37; text-decoration: none; font-size: 1.5rem; font-weight: bold; }
        h2 { margin: 0; font-size: 1.1rem; letter-spacing: 1px; text-transform: uppercase; color: #D4AF37; }

        /* Scrollable List */
        .list-container { flex: 1; overflow-y: auto; padding: 10px; padding-bottom: 80px; }
        
        .player-row { 
            display: flex; align-items: center; background: #1a1a1a; 
            margin-bottom: 8px; padding: 10px; border-radius: 12px; 
            border: 1px solid #333; transition: 0.2s;
        }
        
        /* Top 3 Special Styles */
        .rank-1 { background: linear-gradient(90deg, #222, #3a2e00); border-color: #FFD700; }
        .rank-2 { background: linear-gradient(90deg, #222, #2a2a2a); border-color: #C0C0C0; }
        .rank-3 { background: linear-gradient(90deg, #222, #2a1d15); border-color: #CD7F32; }

        .rank-num { width: 30px; font-weight: bold; font-size: 1.1rem; color: #666; text-align: center; }
        .rank-1 .rank-num { color: #FFD700; } 
        .rank-2 .rank-num { color: #C0C0C0; }
        .rank-3 .rank-num { color: #CD7F32; }

        .avatar { 
            width: 45px; height: 45px; border-radius: 50%; object-fit: cover; 
            margin: 0 15px; border: 2px solid #444; background: #000;
        }
        
        .info { flex: 1; display: flex; flex-direction: column; }
        .name { font-weight: 600; font-size: 0.95rem; color: #eee; }
        .uid { font-size: 0.75rem; color: #888; }
        
        .score { font-weight: bold; color: #D4AF37; font-size: 1.1rem; }

        .empty-msg { text-align: center; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="home.html" class="back">‚ùÆ</a>
        <h2>Winners Circle</h2>
        <div style="width: 20px;"></div>
    </div>

    <div class="list-container" id="list">
        <div class="empty-msg">Loading Champions...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyDKO9G5GLdHk5D_UCzDx-A76yb80zvesJ4", authDomain: "quiz-55a8d.firebaseapp.com", databaseURL: "https://quiz-55a8d-default-rtdb.firebaseio.com", projectId: "quiz-55a8d", storageBucket: "quiz-55a8d.firebasestorage.app", messagingSenderId: "745030366382", appId: "1:745030366382:web:25d6210f97391136d5693f" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        onValue(ref(db, 'users'), (snap) => {
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let users = [];
            snap.forEach(c => { 
                const u = c.val();
                // FILTER: Only active users AND users with score > 0
                if(u.status === 'active' && u.score > 0) {
                    users.push(u); 
                }
            });
            
            // Sort by Score (High to Low)
            users.sort((a,b) => (b.score || 0) - (a.score || 0));

            if(users.length === 0) {
                list.innerHTML = '<div class="empty-msg">No winners yet.<br>Start playing to reach the top!</div>';
                return;
            }

            users.forEach((u, index) => {
                const rank = index + 1;
                
                // Avatar Logic
                const img = u.profilePic ? u.profilePic : `https://ui-avatars.com/api/?name=${u.fname}+${u.lname}&background=1a1a1a&color=fff&size=128`;
                
                const html = `
                    <div class="player-row rank-${rank}">
                        <div class="rank-num">${rank}</div>
                        <img src="${img}" class="avatar">
                        <div class="info">
                            <span class="name">${u.fname} ${u.lname}</span>
                            <span class="uid">Season 1 Winner</span>
                        </div>
                        <div class="score">${u.score}</div>
                    </div>
                `;
                list.innerHTML += html;
            });
        });
    </script>
</body>
</html>
