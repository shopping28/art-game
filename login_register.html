<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ART QUIZ</title>
    <style>
        body { background: #050505; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .box { background: #111; padding: 40px; border: 1px solid #D4AF37; width: 90%; max-width: 400px; border-radius: 10px; box-shadow: 0 0 30px rgba(212, 175, 55, 0.15); text-align: center; }
        h2 { color: #D4AF37; letter-spacing: 2px; margin-bottom: 30px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #D4AF37; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; border-radius: 5px; }
        .toggle { margin-top: 20px; font-size: 0.8rem; color: #888; cursor: pointer; }
        .toggle span { color: #D4AF37; }
        #errMsg { margin-top: 15px; font-size: 0.85rem; min-height: 20px; color: red; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="box">
    <h2 id="title">MEMBER LOGIN</h2>
    
    <!-- Login -->
    <div id="loginForm">
        <input type="number" id="lPhone" placeholder="Mobile Number">
        <input type="password" id="lPass" placeholder="Password">
        <button onclick="login()">ENTER</button>
        <div class="toggle" onclick="toggle()">New Here? <span>Request Registration</span></div>
    </div>

    <!-- Register -->
    <div id="regForm" class="hidden">
        <input type="text" id="fname" placeholder="First Name">
        <input type="text" id="lname" placeholder="Last Name">
        <input type="text" id="shopId" placeholder="Shopping ID">
        <input type="text" id="userId" placeholder="User ID">
        <input type="number" id="rPhone" placeholder="Mobile Number">
        <input type="password" id="rPass" placeholder="Password">
        <button onclick="register()">SEND REQUEST</button>
        <div class="toggle" onclick="toggle()">Have Account? <span>Login</span></div>
    </div>

    <div id="errMsg"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, get, child, push } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyDKO9G5GLdHk5D_UCzDx-A76yb80zvesJ4", authDomain: "quiz-55a8d.firebaseapp.com", databaseURL: "https://quiz-55a8d-default-rtdb.firebaseio.com", projectId: "quiz-55a8d", storageBucket: "quiz-55a8d.firebasestorage.app", messagingSenderId: "745030366382", appId: "1:745030366382:web:25d6210f97391136d5693f" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.toggle = () => {
        document.getElementById('loginForm').classList.toggle('hidden');
        document.getElementById('regForm').classList.toggle('hidden');
        document.getElementById('title').innerText = document.getElementById('regForm').classList.contains('hidden') ? "MEMBER LOGIN" : "REGISTRATION";
        document.getElementById('errMsg').innerText = "";
    }

    window.register = () => {
        const d = {
            fname: document.getElementById('fname').value,
            lname: document.getElementById('lname').value,
            shopId: document.getElementById('shopId').value,
            userId: document.getElementById('userId').value,
            phone: document.getElementById('rPhone').value,
            pass: document.getElementById('rPass').value,
            status: 'pending',
            joinDate: new Date().toLocaleDateString(),
            score: 0
        };
        
        if(!d.phone || !d.pass) return alert("Fill all fields");

        set(ref(db, 'users/' + d.phone), d).then(() => {
            document.getElementById('errMsg').innerText = "Request Sent. Wait for Admin Approval.";
            document.getElementById('errMsg').style.color = "#D4AF37";
            setTimeout(toggle, 2000);
            
            // Trigger Global Notification
            push(ref(db, 'global_events'), {
                type: 'new_user',
                text: `${d.fname} just joined the game!`,
                timestamp: Date.now()
            });
        });
    }

    window.login = () => {
        const p = document.getElementById('lPhone').value;
        const pass = document.getElementById('lPass').value;
        const err = document.getElementById('errMsg');

        get(child(ref(db), `users/${p}`)).then((snap) => {
            if (snap.exists()) {
                const u = snap.val();
                if(u.pass === pass) {
                    if(u.status === 'active') {
                        localStorage.setItem('artUser', JSON.stringify(u));
                        window.location.href = 'home.html';
                    } else if (u.status === 'pending') {
                        err.style.color = "orange";
                        err.innerText = "Account is pending Admin approval.";
                    } else {
                        // REJECTED / BLOCKED MESSAGE
                        err.style.color = "red";
                        err.innerText = "YOUR NO ACCOUNT FOR SHOPPING28 PAID ACCOUNT ACTIVE AND TRY AGAIN";
                    }
                } else {
                    err.style.color = "red";
                    err.innerText = "Wrong Password.";
                }
            } else {
                err.style.color = "red";
                err.innerText = "No account found.";
            }
        });
    }
</script>
</body>
</html>
